;/*
 * MTA v1.1.9
 * (c) 2014-2020
 * 美团点评 - 性能平台 
 */
!function(){"use strict";function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function e(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function d(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e){return"number"==typeof e}var c=Array.prototype,t=Object.prototype,h=t.hasOwnProperty,n=t.toString,y=function(e){return"function"==typeof e};function g(t){if("undefined"!=typeof JSON&&y(JSON.stringify)){var n="";try{n=JSON.stringify(t)}catch(e){var r=[];n=JSON.stringify(t,function(e,t){if("object"===f(t)&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t})}return n}switch(f(t)){case"string":return'"'.concat(t,'"');case"boolean":case"number":return String(t);case"object":if(null===t)return"null";var e,o,i=!1,a="";for(var s in t){h.call(t,s)&&(e="'".concat(s,"'"),(o=g(t[s])).length&&(i?a+=",":i=!0,a+=v(t)?o:'"'.concat(e,'":').concat(o)))}return v(t)?"[".concat(a,"]"):"{".concat(a,"}");default:return""}}function p(e){if("object"!==f(e)&&"function"!=typeof e||null===e)return[];if(y(Object.keys))return Object.keys(e);var t=[];for(var n in e)h.call(e,n)&&t.push(n);return t}function v(e){return y(Array.isArray)?Array.isArray(e):"[object Array]"===n.call(e)}function m(e,t,n){if(y(c.map))return e.map(t,n);for(var r=[],o=e.length,i=0;i++<o;)r.push(t.call(n,e[i],i,e));return r}function w(e,n){if(y(c.forEach))e.forEach(function(e,t){n(e,t)});else for(var t=e.length,r=0;r++<t;)n(e[r],r)}function _(e,t,n){if(y(c.filter))return e.filter(t,n);for(var r=[],o=e.length,i=0;i++<o;)t.call(n,e[i],i,e)&&r.push(e[i]);return r}function E(){}function b(e){if("file:"!==window.location.protocol){var t=l({method:"GET",async:!0,success:E,fail:E},e),n=-1!==window.navigator.appName.indexOf("Microsoft Internet Explorer")&&(-1!==window.navigator.userAgent.indexOf("MSIE 8.0")||-1!==window.navigator.userAgent.indexOf("MSIE 9.0"))&&window.XDomainRequest,r=new(n?XDomainRequest:XMLHttpRequest);r.open(t.method,t.url,t.async);var o=function(e){e&&(!/dreport.meituan.net/.test(t.url)&&"//portal-portm.sankuai.com/metrics_web/config/report"!==t.url||(200===e.currentTarget.status?t.success&&t.success(e.currentTarget.response):t.fail&&t.fail()))};if(/dreport.meituan.net/.test(t.url)&&!n||"//portal-portm.sankuai.com/metrics_web/config/report"===t.url)if("addEventListener"in r)r.addEventListener("load",o),r.addEventListener("error",o),r.addEventListener("abort",o);else try{var i=r.onreadystatechange;r.onreadystatechange=function(e){4===this.readyState&&o(e),i&&i.apply(this,arguments)}}catch(e){console.log(e)}try{r.send(g(t.data))}catch(e){}return r}}var S={get:function(e){for(var t=document.cookie,n="".concat(e,"="),r=n.length,o=t.length,i=0;i<o;){var a=i+r;if(t.substring(i,a)===n)return function(e){var t=document.cookie,n=t.indexOf(";",e);-1===n&&(n=t.length);return decodeURIComponent(t.substring(e,n))}(a);if(0===(i=t.indexOf(" ",i)+1))break}return""},set:function(e,t,n,r,o,i){o=o||function(){var e=document.domain;if("localhost:"===e)return"";"undefined"!=typeof M&&M.DOMAIN_HOST&&(e=".".concat(M.DOMAIN_HOST));"www."===e&&(e=e.substring(0,4));return e}();var a=(r?"; path=".concat(r):"")+(o?"; domain=".concat(o):"")+(i?"; secure":"");document.cookie=t?"".concat(e,"=").concat(encodeURIComponent(String(t)))+(n?"; expires=".concat(n):"")+a:"".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT")+(r?"; path=".concat(r):"")+a},getExpire:function(e,t,n){var r=new Date;if(s(e)&&s(t)&&s(n))return r.setDate(r.getDate()+parseInt(e,10)),r.setHours(r.getHours()+parseInt(t,10)),r.setMinutes(r.getMinutes()+parseInt(n,10)),r.toUTCString()}},C={};function T(e,t,n,r){var o=3<arguments.length&&void 0!==r&&r;return e&&(e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n))}var j={on:function(e,t){y(t)&&(C[e]||(C[e]=[])).push(t)},emit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t.slice(1);if(C[r])for(var i=0;i<C[r].length;i++)C[r][i].apply(this,o)},addEvent:function(e,t){T(window,e,t,2<arguments.length&&void 0!==arguments[2]&&arguments[2])},removeEvent:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return window.removeEventListener?window.removeEventListener(e,t,n):window.detachEvent?window.detachEvent("on".concat(e),t):void 0},addEventToSelectors:function(e,n,r){var o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e&&0<e.length?e.forEach(function(e){var t=document.getElementById(e);t&&T(t,n,r,o)}):T(window,n,r,o)}};function O(e,t){return e<=0||t<=0||e-t<=0?0:parseInt(e-t,10)}function I(e,t){var n,r={};for(n in e)r[n]=e[n];for(n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(r[n]=t[n]);return r}function x(){return window.autoincrement++,window.autoincrement.toString()}var L=function(){var r=("undefined"==typeof window||window!==this)&&"undefined"!=typeof global&&null!=global?global:this,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};function n(){n=function(){},r.Symbol||(r.Symbol=e)}var o=0;function e(e){return"jscomp_symbol_"+(e||"")+o++}function i(){n();var e=(e=r.Symbol.iterator)||(r.Symbol.iterator=r.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&t(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return a(this)}}),i=function(){}}function a(e){var t,n=0;return t=function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}},i(),(t={next:t})[r.Symbol.iterator]=function(){return this},t}function f(e){i();var t=e[Symbol.iterator];return t?t.call(e):a(e)}function d(e){if(!(e instanceof Array)){e=f(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}var h=0;var s="img script iframe link audio video source".split(" ");function g(n){var e=new MutationObserver(function(e){for(var t=(e=f(e)).next();!t.done;t=e.next())("childList"==(t=t.value).type&&function e(t,n){for(var r=(t=f(t)).next();!r.done;r=t.next())if(r=r.value,n.includes(r.nodeName.toLowerCase())||e(r.children,n))return 1}(t.addedNodes,s)||"attributes"==t.type&&s.includes(t.target.tagName.toLowerCase()))&&n(t)});return e.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),e}function p(e,t){if(2<e.length)return performance.now();for(var n=[],r=(t=f(t)).next();!r.done;r=t.next())r=r.value,n.push({timestamp:r.start,type:"requestStart"}),n.push({timestamp:r.end,type:"requestEnd"});for(r=(t=f(e)).next();!r.done;r=t.next())n.push({timestamp:r.value,type:"requestStart"});for(n.sort(function(e,t){return e.timestamp-t.timestamp}),e=e.length,t=n.length-1;0<=t;t--)switch((r=n[t]).type){case"requestStart":e--;break;case"requestEnd":if(2<++e)return r.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function c(e){e=e||{},this.w=!!e.useMutationObserver,this.u=e.minValue||null,e=window.__tti&&window.__tti.e;var o,i,a,s,c,u,l,r,t=window.__tti&&window.__tti.o;this.a=e?e.map(function(e){return{start:e.startTime,end:e.startTime+e.duration}}):[],t&&t.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,o=this.m.bind(this),i=this.l.bind(this),a=XMLHttpRequest.prototype.send,s=h++,XMLHttpRequest.prototype.send=function(e){for(var t=[],n=0;n<arguments.length;++n)t[+n]=arguments[n];var r=this;return o(s),this.addEventListener("readystatechange",function(){4===r.readyState&&i(s)}),a.apply(this,t)},c=this.m.bind(this),u=this.l.bind(this),l=fetch,fetch=function(e){for(var o=[],t=0;t<arguments.length;++t)o[+t]=arguments[t];return new Promise(function(t,n){var r=h++;c(r),l.apply(null,[].concat(d(o))).then(function(e){u(r),t(e)},function(e){u(e),n(e)})})},(r=this).c=new PerformanceObserver(function(e){for(var t,n=(e=f(e.getEntries())).next();!n.done;n=e.next()){"resource"===(n=n.value).entryType&&(r.b.push({start:n.fetchStart,end:n.responseEnd}),v(r,p(r.g,r.b)+5e3)),"longtask"===n.entryType&&(t=n.startTime+n.duration,r.a.push({start:n.startTime,end:t}),v(r,t+5e3))}}),r.c.observe({entryTypes:["longtask","resource"]}),this.w&&(this.h=g(this.B.bind(this)))}function u(e){e.i=!0;var t=0<e.a.length?e.a[e.a.length-1].end:0,n=p(e.g,e.b);v(e,Math.max(n+5e3,t))}function v(i,e){!i.i||i.v>e||(clearTimeout(i.j),i.j=setTimeout(function(){var e=performance.timing.navigationStart,t=p(i.g,i.b),e=(window.a&&window.a.A?1e3*window.a.A().C-e:0)||performance.timing.domContentLoadedEventEnd-e,n=i.u?i.u:performance.timing.domContentLoadedEventEnd?(n=performance.timing).domContentLoadedEventEnd-n.navigationStart:null,r=performance.now();null===n&&v(i,Math.max(t+5e3,r+1e3));var o=i.a;(t=r-t<5e3?null:r-(t=o.length?o[o.length-1].end:e)<5e3?null:Math.max(t,n))&&(i.s(t),clearTimeout(i.j),i.i=!1,i.c&&i.c.disconnect(),i.h&&i.h.disconnect()),v(i,performance.now()+1e3)},e-performance.now()),i.v=e)}c.prototype.getFirstConsistentlyInteractive=function(){var t=this;return new Promise(function(e){t.s=e,"complete"==document.readyState?u(t):window.addEventListener("load",function(){u(t)})})},c.prototype.m=function(e){this.f.set(e,performance.now())},c.prototype.l=function(e){this.f.delete(e)},c.prototype.B=function(){v(this,performance.now()+5e3)},r.Object.defineProperties(c.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(d(this.f.values()))}}});var l={getFirstConsistentlyInteractive:function(e){return e=e||{},"PerformanceLongTaskTiming"in window?new c(e).getFirstConsistentlyInteractive():Promise.resolve(null)}};return"undefined"!=typeof module&&module.exports?module.exports=l:"function"==typeof define&&define.amd?define("ttiPolyfill",[],function(){return l}):l}.call(window),A=function(){function n(e,t){o(this,n),u(this,"_MAX_URL_LENGTH",2083),this.url=e,this.devMode=t}return e(n,[{key:"config",value:function(e){this.url=e}},{key:"send",value:function(e,t){if(!this.devMode&&g(e).length)return this._post(e,t)}},{key:"_sendByScript",value:function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="".concat(this.url,"?").concat(e);var n=document.getElementsByTagName("script")[0];n.parentNode&&n.parentNode.insertBefore(t,n)}},{key:"_post",value:function(e,t){return b({url:this.url,method:"POST",data:e,success:t&&t.success,fail:t&&t.fail})}}]),n}(),N=function(){function r(){o(this,r),u(this,"_COOKIE_USER_TRACKING","__mta"),u(this,"_COOKIE_USER_TRACKING_VISIT_ID","__mta_visit_id");var e=window.screen,t=window.navigator,n=this._getViewport();this.screen=e?"".concat(e.width,"x").concat(e.height):"-",this.viewport="".concat(n.width,"x").concat(n.height),this.javaEnabled=t&&t.javaEnabled()?1:0,this.ua=t.userAgent,this.isFirstVisit=!1,this._setCookie(),this.visit_id=this._getVisitId(),this.other_uuid=S.get("uuid")||S.get("unionid")||S.get("dpid")||S.get("_lxsdk_cuid")}return e(r,[{key:"getInfo",value:function(){return{sr:this.screen,vp:this.viewport,csz:document.cookie?document.cookie.length:0,ua:this.ua,uuid:this.uuid,url:location.href,sdkVersion:"1.1.9",region:"",operator:"",network:this._getNetwork(),container:"",os:"",visit_id:this.visit_id,other_uuid:this.other_uuid}}},{key:"_getVisitId",value:function(){var e="0";try{e=([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(e){return(Number(e)^(window.crypto?window.crypto.getRandomValues(new Uint8Array(1))[0]:Math.floor(300*Math.random()))&15>>Number(e)/4).toString(16)})}catch(e){console.log(e)}return window.sessionStorage&&window.sessionStorage.setItem(this._COOKIE_USER_TRACKING_VISIT_ID,e),e}},{key:"_setCookie",value:function(){var e,t,n=S.getExpire(720,0,0),r=this._getCurrentTime(),o=S.get(this._COOKIE_USER_TRACKING);o?((e=o.split("."))[2]=e[3],e[3]=String(r),e[4]=String(parseInt(e[4],10)+1),S.set(this._COOKIE_USER_TRACKING,e.join("."),n),this.uuid=e[1]):(o=[t=this._hashInfo(),r,r,r,1].join("."),S.set(this._COOKIE_USER_TRACKING,o,n),this.isFirstVisit=!0,this.uuid=String(t))}},{key:"_getCurrentTime",value:function(){return(new Date).getTime()}},{key:"_hashInfo",value:function(){for(var e=window,t=e.navigator,n=e.history.length,r=t.appName+t.appVersion+this._getEnvLanguage()+t.platform+t.userAgent+this.javaEnabled+this.screen+(document.cookie?document.cookie:"")+(document.referrer?document.referrer:""),o=r.length;0<n;)r+=n--^o++;return function(e){var t,n,r=1;if(e)for(r=0,n=e.length-1;0<=n;n--)r=0!=(t=266338304&(r=(r<<6&268435455)+(t=e.charCodeAt(n))+(t<<14)))?r^t>>21:r;return r}(r)}},{key:"_getViewport",value:function(){var e={width:document.body&&document.body.clientWidth||0,height:document.body&&document.body.clientHeight||0};return null!==window.innerWidth&&(e={width:window.innerWidth,height:window.innerHeight}),"CSS1Compat"===document.compatMode&&(e={width:document.documentElement&&document.documentElement.clientWidth||0,height:document.documentElement&&document.documentElement.clientHeight||0}),e}},{key:"_getEnvLanguage",value:function(){return(navigator&&(navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:"-")).toLowerCase()}},{key:"_getNetwork",value:function(){var e,t,n=S.get("network");return n||(t=/NetType\/([a-zA-Z0-9]+)/,(e=window.navigator.userAgent)&&t.test(e)&&(n=e.match(t)[1])),n||""}}]),r}(),P="error",R=["project","resource_url","sec_category","level","ts","content"],D=["line","column","tags"].concat(R),q=function(){function n(e){if(o(this,n),e){var t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.parse(e)}}return e(n,[{key:"parse",value:function(){this.level||(this.level=P),this.ts||(this.ts=+new Date),this.sec_category||(this.sec_category="default")}},{key:"isEqual",value:function(e){return this.sec_category===e.sec_category&&this.resource_url===e.resource_url&&this.column===e.column&&this.line===e.line&&this.content===e.content}},{key:"update",value:function(e){for(var t in e)void 0!==e[t]&&-1!==D.indexOf(t)&&(this[t]=e[t]);return this}},{key:"updateTags",value:function(e){var t=I(this.tags||{},e);return this.tags=t,this}},{key:"toJson",value:function(){var t=this,n={};return R.map(function(e){void 0!==t[e]&&(n[e]=t[e])}),n}}]),n}(),J="metrics_cache";var F={isSupport:function(){var e="local_test";try{localStorage.setItem(e,1),localStorage.removeItem(e)}catch(e){return!1}return!0}(),get:function(){if(this.isSupport){var e=[];try{var t=localStorage.getItem(J);t&&(e=JSON.parse(t))}catch(e){console.log(e)}return e}},add:function(e){if(this.isSupport&&e instanceof Array){var t=this.get();e=e.concat(t);try{localStorage.setItem(J,JSON.stringify(e))}catch(e){console.log(e)}}},clear:function(){if(this.isSupport)try{localStorage.removeItem(J)}catch(e){console.log(e)}}},H=function(){function n(e){var t=this;o(this,n),this.cfgManager=e,this.jsErrorEnable=e.jsError&&e.jsError.enable,this.jsErrorApi=e.url,this.beacon=new A(e.url,e.devMode),this.cache=[],this.cacheSending={},this.comboTimeout=0,this.timeLimit=Date.now(),this.errorCount=0,this.isTimeLimit=!1,this.detectLeave(),this.getJsErrorConfig=function(e){return t.cfgManager.jsError&&t.cfgManager.jsError[e]}}return e(n,[{key:"_handleError",value:function(t){try{var e=this.getJsErrorConfig("onErrorPush");if(e instanceof Function&&(t=e(t)),t instanceof q||void 0===t)return t;console.log("onErrorPush\u65b9\u6cd5\u8fd4\u56de\u7ed3\u679c\u6709\u8bef")}catch(e){return console.log("onErrorPush\u65b9\u6cd5\u5904\u7406\u6709\u8bef",e),t}}},{key:"parseWindowError",value:function(e,t,n,r,o){try{o&&o.stack?this.push(o):"string"==typeof e&&this._push({sec_category:e,resource_url:t,line:n,column:r})}catch(e){this.reportSystemError(e)}}},{key:"parsePromiseUnhandled",value:function(e){if(e)try{var t=e.reason;t&&(t instanceof Error?this.push(t,{sec_category:"unhandledrejection"}):this._push({sec_category:"unhandledrejection",content:t}))}catch(e){console.log(e)}}},{key:"parseConsoleError",value:function(){try{var e=[].slice.call(arguments);if(!e||!e.length)return;for(var t=[],n=0;n<e.length;n++){var r=e[n];"string"!=typeof e[n]&&(r=e[n]instanceof window.Error?JSON.stringify(e[n].stack):JSON.stringify(e[n])),t.push(r)}t&&t.length&&this._push({sec_category:"consoleError",content:t.join(" ")})}catch(e){this.reportSystemError(e)}}},{key:"detectLeave",value:function(){var u=arguments,l=this;try{var f=window.onbeforeunload;window.onbeforeunload=function(){var e,t,n=l.addCacheExtension(),r=l.cacheSending,o=n;if(p(r))for(var i in r)if(r.hasOwnProperty(i)&&void 0!==r[i]){var a=r[i],s=a.xhr,c=a.cache;try{s.abort()}catch(e){console.log(e)}o=o.concat(c)}o&&o.length&&(window.navigator.sendBeacon&&l.getJsErrorConfig("useSendBeacon")?(e=function(e,t){if(!t)return e;var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(r+"="+t[r]);return~e.indexOf("?")?e+"&"+n.join("&"):e+"?"+n.join("&")}(l.cfgManager.url,{beacon:1}),window.navigator.sendBeacon(e,(t=o,"c="+encodeURIComponent(JSON.stringify(t))))):l.getJsErrorConfig("disableCache")||F.add(o)),f&&f.apply(l,u)}}catch(e){console.log(e)}}},{key:"checkCache",value:function(){var e,t=this;this.getJsErrorConfig("disableCache")||(e=F.get())&&e.length&&setTimeout(function(){t.doSend({url:t.cfgManager.url,data:e,success:function(){F.clear()}})},1500)}},{key:"reportSystemError",value:function(e){if(e&&e.stack){var t=e.msg||e.name||"parseError";try{t=JSON.stringify(e.stack)}catch(e){console.error("JSON.stringify(err.stack) \u51fa\u9519")}this.cache.push(new q({project:"metrics",sec_category:e.msg||e.name||"parseError",content:t,flow_ids:this.cfgManager.getFlowIds(),id:x()})),this.send(!0)}}},{key:"_processError",value:function(t){function u(e){return{sec_category:"Invalid_Error",content:"object"===f(e)?JSON.stringify(e):e}}try{return function(e){var t,n=e.line,r=e.column,o=e.message||e.name||"";if(e.stack){var i=(i=e.stack.match("https?://[^\n]+"))?i[0]:"",a=/https?:\/\/(\S)*\.js/,s="";a.test(i)&&(s=i.match(a)[0]);var c=(c=i.match(":(\\d+):(\\d+)"))||[0,0,0];return{sec_category:o,content:(t=e)&&t.stack||"",line:void 0!==n?n:c[1],column:void 0!==r?r:c[2],resource_url:s}}return u(e)}(t)}catch(e){return this.reportSystemError(t),u(t)}}},{key:"_push",value:function(e,t){e=this.parse(e),this.push(new q(e),t)}},{key:"_pushResource",value:function(){1<Math.random()||this._push.apply(this,arguments)}},{key:"parse",value:function(e){return e.project||(e.project=this.cfgManager.clientInfo.token),e}},{key:"push",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};if(e&&!(Math.random()>this.getJsErrorConfig("sample")))if(e instanceof q||(e instanceof Error?e=this._processError(e):"string"==typeof e?e={sec_category:e}:"object"===f(e)&&(e={sec_category:e.name,content:e.msg}),e=this.parse(e),e=new q(e)),e&&e.content&&e.content.length>=this.getJsErrorConfig("maxSize"))console.log("[Error]: \u9519\u8bef\u957f\u5ea6\u5927\u4e8e".concat(this.getJsErrorConfig("maxSize")));else{e.update(n);var r=this.getJsErrorConfig("filters"),o=!0;if(this.getJsErrorConfig("noScriptError")&&0===e.sec_category.indexOf("Script error"))return!1;if(r&&r.length)for(var i=0;i<r.length;i++){if(!r[i].fn(e))return!1}var a=this.getJsErrorConfig("ignoreList");if(a&&a.length)for(var s=0;s<a.length;s++){var c=a[s];if(0===e.sec_category.indexOf(c)){o=!1;break}}o&&(this.isExist(e)||(this.onPush&&this.onPush(e),(e=this._handleError(e))&&(e.id=x(),e.flow_ids=this.cfgManager.getFlowIds(),this.cache.push(e),this.send())))}}},{key:"isExist",value:function(e){for(var t=0;t<this.cache.length;t++){var n=this.cache[t];if(n instanceof q||(n=new q(n)),n.isEqual(e))return!0}return!1}},{key:"report",value:function(){this.push.apply(this,arguments),this.send(!0)}},{key:"send",value:function(e){var r=this,t=this.cfgManager,o=this.comboTimeout,i=this.getJsErrorConfig("maxNum")||100,a=this.getJsErrorConfig("maxTime")||6e4,s=Date.now()-this.timeLimit;this.isTimeLimit||(this.timeLimit=Date.now()),this.isTimeLimit=!0;function n(){if(r.cache.length){clearTimeout(o),o=0,r.onSubmit&&r.onSubmit(r.cache);var e=r.addCacheExtension(),t=+new Date;try{if(r.errorCount=r.errorCount+r.cache.length,s<=a){if(r.errorCount>=i)return}else r.isTimeLimit=!1,r.errorCount=0}catch(e){console.log(e)}var n=r.doSend({url:r.cfgManager.url,data:e,success:function(){r.nextCache=[];try{delete r.cacheSending[t]}catch(e){console.log(e)}},fail:function(){r.getJsErrorConfig("disableCache")||F.add(r.nextCache)}});r.cacheSending[t]={xhr:n,cache:e},r.nextCache=e,r.cache=[]}}var c=t.jsError&&t.jsError.delay||100;e?n():o||-1===c||(o=setTimeout(n,c))}},{key:"addCacheExtension",value:function(){var e=this.cfgManager,o=this.cache,i=[],a=e.jsError&&e.jsError.ext;if(!o||!o.length)return i;for(var t=0;t<o.length;t++)!function(e){var t=o[e];a&&"object"===f(a)&&(t=I(t.toJson(),a));var n,r={type:"jsError",value:1,ts:t.ts,tags:t};"resourceError"===t.type&&(r.type="resourceError",delete t.type),i.push(r),t.flow_ids&&(n=t.flow_ids.split(";").map(function(e){return{type:"browser.flow.relation",value:1,ts:+new Date,tags:u({flow_id:e},r.type+"_id",t.id)}}),i=i.concat(n))}(t);return i}},{key:"doSend",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(t&&t.data){t.beforeSend&&t.beforeSend();var n=[{category:"met_fe_web_log",env:l(l(l({token:this.cfgManager.token},this.cfgManager.clientInfo),this.cfgManager._tags),{},{url:location.href}),logs:t.data}];return this.beacon.send(n,t)}}}]),n}();var V=function(){function r(e,t){var n=this;o(this,r),this.cfgManager=e,this.errManager=t,this.getResourceErrorConfig=function(e){return n.cfgManager.resourceError&&n.cfgManager.resourceError[e]}}return e(r,[{key:"parseType",value:function(e){if(!e)return"";switch(e){case"script":return"js";case"link":return"css";case"img":return"image";default:return e}}},{key:"filterResource",value:function(e){var t=!0,n=this.getResourceErrorConfig("ignoreList")||[];try{for(var r=0;r<n.length;r++){if(new RegExp(n[r]).test(e)){t=!1;break}}return t}catch(e){return console.log(e),t}}},{key:"parseResourceError",value:function(e){var t,n,r,o=this,i=e.target||e.srcElement;try{if(!(i instanceof HTMLScriptElement||i instanceof HTMLLinkElement||i instanceof HTMLImageElement))return;t=i.src||i.href,n=i.nodeName,r=t,"img"===n&&(r=function(e){var t=e.split("//");if(t&&1<t.length)return t[0]+"//"+t[1].split("/")[0]+"/images"}(t)),r&&o.filterResource(r)&&o.errManager._pushResource({type:"resourceError",sec_category:n,content:t,ts:+new Date})}catch(e){this.errManager.reportSystemError(e)}}}]),r}();var U=function(e,t){if(e.nodeType!==Node.ELEMENT_NODE)return null;var n=e.parentNode;if(!n||n.nodeType===Node.DOCUMENT_NODE)return new Q(r,!0);var r=e.nodeName,o=r.toLowerCase();if("body"===o||"head"===o||"html"===o)return new Q(o,!0);var i,a=e.getAttribute("id");if(a)return new Q((i=a,"#"+CSS.escape(i)),!0);function s(e){var t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map(function(e){return"$"+e}):[]}for(var c=s(e),u=!1,l=!1,f=-1,d=-1,h=n.children,g=0;(-1===f||!l)&&g<h.length;++g){var p=h[g];if(p.nodeType===Node.ELEMENT_NODE)if(d+=1,p!==e){if(!l&&p.nodeName===r){u=!0;var v=new Set(c);if(v.size)for(var m=s(p),w=0;w<m.length;++w){var y=m[w];if(v.has(y)&&(v.delete(y),!v.size)){l=!0;break}}else l=!0}}else f=d}var _=o;if(t&&"input"===r.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(_+="[type="+CSS.escape(e.getAttribute("type"))+"]"),l)_+=":nth-child("+(f+1)+")";else if(u){var E,b=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(c);try{for(b.s();!(E=b.n()).done;){var S=E.value;_+="."+CSS.escape(S.slice(1))}}catch(e){b.e(e)}finally{b.f()}}return new Q(_,!1)},Q=function(){function n(e,t){o(this,n),this.value=e,this.optimized=t||!1}return e(n,[{key:"toString",value:function(){return this.value}}]),n}();function z(){var r=Date.now(),o=0;function e(e){var t=e.target?e.target:e.srcElement;if(o++,6e4<Date.now()-r&&(r=Date.now(),o=0),o<=20){var n=t&&t.outerHTML;try{n=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return"";for(var t=[],n=e;n;){var r=U(n,n===e);if(!r)break;if(t.push(r),r.optimized)break;n=n.parentNode}return t.reverse(),t.join(" > ")}(t)}catch(e){console.log("\u83b7\u53d6\u9009\u62e9\u5668\u51fa\u9519\uff1a"+e)}n&&200<n.length&&(n=n.slice(0,200)),window.mta&&window.mta("count","browser.click",1,{selector:n,tagName:t&&t.tagName})}}window.addEventListener?window.addEventListener("click",e,!0):document.attachEvent("onclick",e)}window.autoincrement=1;var G={activate:"activate",create:"create",config:"config",tag:"tag",timing:"sendTiming",count:"sendCount",gauge:"sendGauge",send:"send",stop:"stop",on:"_on",enable:"enable",test:"testStart",testEnd:"testEnd",sendJsError:"sendJsError"},B=function(){function c(e){var t=this;o(this,c),u(this,"_PERF_CATEGORY","fe_perf_web"),u(this,"_SNIFFER_CATEGORY_V1","met_fe_web_log"),u(this,"_SNIFFER_REG",/^sniffer/),u(this,"_SEND_DELAY",100),this.trackerConfig=l({useCombo:!0,sampleRate:100,devMode:!1,url:"".concat(location.protocol,"//dreport.meituan.net"),getFlowIds:function(){return t._testQueue.map(function(e){return e.flow_id}).join(";")},clientInfo:this.clientInfo},e),this.client=new N,this.beacon=new A(this.trackerConfig.url,this.trackerConfig.devMode),this._visitCode=this._random(),this._queue=[],this._snifferQueueV1=[],this._testQueue=[],this._tags={},this._testQueueId=0,this.jsErrCore=null,this.resourceErrCore=null,this.clientInfo={}}return e(c,[{key:"create",value:function(e,t){this._app=e,this.trackerConfig=l(l(l({},this.trackerConfig),t),{},{sampleRate:5,token:e}),this.beacon=new A(this.trackerConfig.url,this.trackerConfig.devMode),this.getClientInfo(),this.send("resources"),function(e){var t=e.spaMode;function n(){window.mta&&window.mta("count","browser.pv",1)}if(n(),"hash"!==t){if("history"===t){var r=function(t){var n=history[t];return function(){var e=new Event(t);return e.arguments=arguments,window.dispatchEvent(e),n.apply(this,arguments)}};history.pushState=r("pushState"),history.replaceState=r("replaceState"),window.addEventListener("replaceState",n),window.addEventListener("pushState",n)}}else window.addEventListener&&window.addEventListener("hashchange",n)}(this.trackerConfig)}},{key:"getClientInfo",value:function(){if(p(this.clientInfo).length)return this.clientInfo;var e=this.client.getInfo();return this.trackerConfig.clientInfo=e,this.clientInfo=e}},{key:"config",value:function(e,t){var n,r,o=this;if(void 0!==t)switch(e){case"sampleRate":"number"==typeof t&&(this.trackerConfig.sampleRate=t);break;case"useCombo":"boolean"==typeof t&&(this.trackerConfig.useCombo=t);break;case"jsError":"object"===f(t)&&(t.maxSize=t.maxSize||10240),this.trackerConfig.jsError=t,this.jsErrCore=new H(this.trackerConfig,this),window._mta_&&(window._mta_.js_error_queue&&window._mta_.js_error_queue.map(function(e){var t;(t=o.jsErrCore).parseWindowError.apply(t,d(e))}),window._mta_.unhandledrejection_error_queue&&window._mta_.unhandledrejection_error_queue.map(function(e){var t;(t=o.jsErrCore).parsePromiseUnhandled.apply(t,d(e))}),window._mta_.js_error_queue=[],window._mta_.unhandledrejection_error_queue=[]),window._mta_js_error_queue=[],function(e){var t=window.onerror;if(e&&(window._mta_&&((window.removeEventListener||window.detachEvent)("unhandledrejection",window._mta_.unhandledrejectionHandler),window._mta_.isReady=!0),!1!==e.jsErrorEnable&&(window.onerror=function(){e.parseWindowError.apply(e,arguments),t&&t.apply(window,arguments)},(window.addEventListener||window.attachEvent)("unhandledrejection",function(){e.parsePromiseUnhandled.apply(e,arguments)})),!0===e.getJsErrorConfig("enableConsole"))){if(!window.console||!window.console.error)return;var n=window.console.error;window.console.error=function(){e.parseConsoleError.apply(e,arguments),n&&n.apply(window.console,arguments)}}}(this.jsErrCore),this.jsErrCore.checkCache();break;case"browser.ajax.business":this.trackerConfig["browser.ajax.business"]=t;break;case"beaconImage":"string"==typeof t&&-1===t.indexOf("frep.meituan.")&&this.beacon.config(this.trackerConfig.url=t);break;case"resourceError":this.trackerConfig.resourceError=t,this.resourceErrCore=new V(this.trackerConfig,this.jsErrCore),(n=this.resourceErrCore)&&(r=window.addEventListener||window.attachEvent,window._mta_&&(window.removeEventListener||window.detachEvent)("error",window._mta_.resourceErrorHandler,!0),!1!==n.getResourceErrorConfig("enable")&&r("error",function(){n.parseResourceError.apply(n,arguments)},!0)),window._mta_&&(window._mta_.resource_error_queue&&window._mta_.resource_error_queue.map(function(e){var t;(t=o.resourceErrCore).parseResourceError.apply(t,d(e))}),window._mta_.resource_error_queue=[]),window._mta_resource_error_queue=[];break;case"click":"object"===f(t)&&(this.trackerConfig.click=t).enable&&z();break;case"scrollFPS":"object"===f(t)&&(this.trackerConfig.scrollFPS=t);break;case"devMode":"boolean"==typeof t&&(this.trackerConfig.devMode=t,this.beacon=new A(this.trackerConfig.url,this.trackerConfig.devMode))}}},{key:"tag",value:function(e,t){"string"==typeof e&&e.length&&(void 0!==f(t)?this._tags[e]=t:delete this._tags[e],this.trackerConfig._tags=this._tags)}},{key:"execute",value:function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++)try{var i,a,s=n[o];y(s)?n[o](this):(i=(s=[].slice.call(s,0))[0],(a=this[G[i]].apply(this,s.slice(1)))&&e.push(a))}catch(e){e++}return 1===e.length?e[0]:e}},{key:"push",value:function(){return this.execute.apply(this,arguments)}},{key:"send",value:function(e,t,n,r){var o,i,a,s=this;!e||-1<["xhr-dispatch","xhr-result.load","browser.xhr"].indexOf(e)||("page"!==e?"resources"!==e?"jsError"!==e?t&&t.url&&/catfront|dreport/.test(t.url)||((o=c.plugins[e])&&(t=o.data(t),r=o.type),i={},t&&("[object Array]"===Object.prototype.toString.call(t)?(a=t.map(function(e){return e.type=e.type||"timer",e.tags=e.tags||s._tags,e}),this._queue=this._queue.concat(a)):(i[e]=t,this._push(r||"timer",i,n))),this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._timer=window.setTimeout(function(){s._sendData()},this._SEND_DELAY)):this.sendJsError(t):this._sendResources():this._sendPage())}},{key:"sendJsError",value:function(e,t){this.jsErrCore.report(e,t)}},{key:"getId",value:x},{key:"clearTestTimer",value:function(t,n){var e=this._testQueue.findIndex(function(e){return e.data===t&&e.id===n});-1<e&&(clearTimeout(this._testQueue[e].timer),this._testQueue.splice(e,1))}},{key:"testEnd",value:function(t,n,e,r){var o=this._testQueue.findIndex(function(e){return e.data===t&&e.id===n});-1<o&&(e.flow_id=this._testQueue[o].flow_id,r?(e.log&&delete e.log,this.send("flow.sucess",t,e,"flow.success")):(e.log&&(e.log=JSON.stringify(e.log)),this.send("flow.fail",t,e,"flow.fail")),this.clearTestTimer(t,n))}},{key:"testStart",value:function(r,o,e){var i=this;o.log=o.log||{};var a=this._testQueueId,t=this.getId();this._testQueueId++;var n=setTimeout(function(){o.end_type="timeout",i.testEnd(r,a,o,!1)},e||2e3);this._testQueue.push({data:r,timer:n,tags:o,id:a,flow_id:t});function s(e,t){var n=!0;if(e)try{n=e()}catch(e){n=!1,console.warn("test callback error",e)}if(t)if(o.log&&"string"==typeof o.log)try{o.log=JSON.parse(o.log),o.log=Object.assign({},o.log,t)}catch(e){console.warn("log:",o.log),console.warn("add extral log failed",e)}else o.log&&"object"===f(o.log)?o.log=Object.assign({},o.log,t):o.log=t;o.end_type="normal",i.testEnd(r,a,o,n)}return s.cancel=function(){return i.clearTestTimer(r,a)},s.test=s}},{key:"sendTiming",value:function(e,t,n){this.send(e,t||1,n,"timer")}},{key:"sendCount",value:function(e,t,n){this.send(e,t||1,n,"counter")}},{key:"sendGauge",value:function(e,t,n){this.send(e,t||1,n,"gauge")}},{key:"enable",value:function(e,t){if(this._isSampleHit()&&("fcp"===e||"tti"===e||"scrollFPS"===e||"page"===e)){var r=this,n=c.plugins[e],o=function(e,t,n){r.sendTiming(e,t,n)};if(n)try{"scrollFPS"===e?n.data(this.trackerConfig[e],t,o):n.data(t,o)}catch(e){}}}},{key:"activate",value:function(e,t,n){if(this._isSampleHit()&&"fps"===e){var r=this,o=c.plugins.fps;if(o)try{this._fps=o.data(t,n,function(e,t,n){r.sendTiming(e,t,n)}),this._fps.activate()}catch(e){}}}},{key:"stop",value:function(e){this._fps&&"fps"===e&&this._fps.stop()}},{key:"_push",value:function(e,t,n){var r,o,i,a,s=p(t)[0];"flow.fail"===e||"flow.success"===e?(r={flow_name:t[s],page_url:location.href.split("?")[0],real_url:location.href,id:n.flow_id,end_type:n.end_type},o=n.log,this._snifferQueueV1.push({type:e,data:u({},e,1),tags:r,ts:String((new Date).valueOf()),raw:o})):("browser.ajax.business"===s&&(i=this.trackerConfig.getFlowIds(),n.flow_ids=i,n.id=this.getId(),i&&(a=i.split(";").map(function(e){return{type:"browser.flow.relation",data:{"browser.flow.relation":1},ts:+new Date,tags:{flow_id:e,ajax_id:n.id}}}),this._snifferQueueV1=this._snifferQueueV1.concat(a))),this._queue.push({type:e,data:t,tags:n||this._tags,ts:String((new Date).valueOf())}))}},{key:"_on",value:function(e,t){j.on(e,t)}},{key:"_sendPage",value:function(){var e=c.plugins.page;e&&e.data()}},{key:"_sendResources",value:function(){var e=this.trackerConfig.resources&&this.trackerConfig.resources.sampleRate||10;if(!(100*Math.random()>e)){var t=c.plugins.resources;if(t)try{var n=t.data();if(!n)return;for(var r=0;r<n.length;r++)for(var o=0;o<n[r].length;o++)this.sendTiming("browser.resource",[n[r][o]])}catch(e){console.error(e)}}}},{key:"_formatAndSendData",value:function(e,t,n){var r=this,o=null,i=[];if(t.length)if(e)1===t.length?i=this._formatLogType(t[0]):w(t,function(e){i.push.apply(i,d(r._formatLogType(e)))}),o=this._formatReportData(i,n),j.emit("data",o),this.beacon.send(o);else for(var a=0;a<t.length;a++){var s=this._formatLogType(t[a]),o=this._formatReportData(s,n);j.emit("data",o),this.beacon.send(o)}}},{key:"_sendData",value:function(){var e;this._isSampleHit()&&(e=this.trackerConfig.useCombo,this._formatAndSendData(e,this._queue),this._queue=[],this._formatAndSendData(e,this._snifferQueueV1,"flow"),this._snifferQueueV1=[])}},{key:"_formatLogType",value:function(e){var t=e.data,n=e.tags,r=e.ts,o=(e.type,p(t)[0]),i=p(t[o]),a="browser.ajax"===o,s=_(i,function(e){return"url"!==e&&"method"!==e});return e.raw?[{type:o,value:t[o],tags:n,ts:r,raw:e.raw}]:a?_(m(s,function(e){return{ts:r,type:"".concat(o,".").concat(e),value:String(Number(t[o][e])),tags:l({url:t[o].url,method:t[o].method.toUpperCase()},n)}}),function(e){var t=e.type,n=e.value;return!("browser.ajax.error"===t&&"0"===n)}):i.length?m(i,function(e){return{type:"".concat(o,".").concat(e),value:t[o][e],tags:n,ts:r}}):[{type:o,value:t[o],tags:n,ts:r}]}},{key:"_formatReportData",value:function(e,t){var n=l(l(l({token:this._app,sdkVersion:"1.1.9"},this.clientInfo),this._tags),{},{url:location.href}),r=this._PERF_CATEGORY;"flow"===t&&(r=this._SNIFFER_CATEGORY_V1);var o={category:r,logs:e,env:{}};return w(p(n),function(e){o.env[e]=n[e]}),[o]}},{key:"_random",value:function(){return Math.round(2147483647*Math.random())}},{key:"_isSampleHit",value:function(){return this._visitCode%1e4<100*this.trackerConfig.sampleRate}}],[{key:"addPlugin",value:function(e,t){if(!y(t.data))throw new Error("Can't add plugin ".concat(e,". The plugin object of data props should be")+" a function, but its type is ".concat(f(t.data)));c.plugins[e]=t}}]),c}();u(B,"plugins",{});function K(e){var t=location.href.split("?")[0];for(var n in e)if(-1<t.indexOf(n)){var r=e[n],o=r.token,i=r.jsError,a=r.resourceError,s=r.enable,c=r.click,u=r.sampleRate;window.mta("create",o,r),window.mta("config","sampleRate",u);for(var l=0;l<s.length;l++)window.mta("enable",s[l]);return window.mta("send","page"),window.mta("config","jsError",i),window.mta("config","resourceError",a),window.mta("config","click",c),void(r&&r["browser.ajax.business"]&&window.mta("config","browser.ajax.business",r["browser.ajax.business"]))}}var W,X={type:"timer",data:function(e){var t=0<arguments.length&&void 0!==e?e:0,n=window.performance||window.mozPerformance;if(n&&n.timing&&!(t<=0)){var r=t-n.timing.navigationStart;if(!(r<=0))return r}}},Y={type:"timer",data:function(e,t,n){var r=1<arguments.length&&void 0!==t?t:{},o=2<arguments.length?n:void 0,i=window.requestAnimationFrame;if(y(i)){var a=e&&e.duration||6e4,s=e&&e.maxCount||null,c=0,u=0,l=null,f=null;return{activate:function(){j.addEvent("blur",g),j.addEvent("focus",h),j.addEvent("visibilitychange",p),document.hasFocus()&&(d(),m())},stop:v}}function d(){u++,l=i(d)}function h(){(!s||c<s)&&(u=0,d(),m())}function g(){l&&cancelAnimationFrame(l),f&&clearInterval(f)}function p(){(document.hidden?g:h)()}function v(){l&&cancelAnimationFrame(l),f&&clearInterval(f),j.removeEvent("blur",g),j.removeEvent("focus",h),j.removeEvent("visibilitychange",p)}function m(){f&&clearInterval(f),f=setInterval(function(){l&&cancelAnimationFrame(l),c++;try{o&&o("browser.page",{fps:Math.min(60,u/(a/1e3))},r)}catch(e){}u=0,(s&&s<=c?v:d)()},a)}}},$={type:"timer",data:function(){var c,u,l=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;l&&(c=null,u=0,function e(){u++,c&&(window.clearTimeout(c),c=null);var t=l.timing;if(t.loadEventEnd){var n,r,o,i=[{data:{"page.redirect":O(t.fetchStart,t.navigationStart)},ts:t.fetchStart},{data:{"page.dns":O(t.domainLookupEnd,t.domainLookupStart)},ts:t.domainLookupEnd},{data:{"page.connect":O(t.connectEnd,t.connectStart)},ts:t.connectEnd},{data:{"page.network":O(t.connectEnd,t.navigationStart)},ts:t.connectEnd},{data:{"page.send":O(t.responseStart,t.requestStart)},ts:t.responseStart},{data:{"page.receive":O(t.responseEnd,t.responseStart)},ts:t.responseEnd},{data:{"page.backend":O(t.responseEnd,t.requestStart)},ts:t.responseEnd},{data:{"page.render":O(t.loadEventEnd,t.loadEventStart)},ts:t.loadEventEnd},{data:{"page.dom":O(t.domComplete,t.domLoading)},ts:t.domComplete},{data:{"page.frontend":O(t.loadEventEnd,t.domLoading)},ts:t.loadEventEnd},{data:{"page.load":O(t.loadEventEnd,t.navigationStart)},ts:t.loadEventEnd},{data:{"page.domReady":O(t.domContentLoadedEventStart,t.navigationStart)},ts:t.domContentLoadedEventStart},{data:{"page.interactive":O(t.domInteractive,t.navigationStart)},ts:t.domInteractive},{data:{"page.ttf":O(t.fetchStart,t.navigationStart)},ts:t.fetchStart},{data:{"page.ttr":O(t.requestStart,t.navigationStart)},ts:t.requestStart},{data:{"page.ttdns":O(t.domainLookupStart,t.navigationStart)},ts:t.domainLookupStart},{data:{"page.ttconnect":O(t.connectStart,t.navigationStart)},ts:t.connectStart},{data:{"page.ttfb":O(t.responseStart,t.navigationStart)},ts:t.responseStart}];"object"===("undefined"==typeof M?"undefined":f(M))&&M.subresources&&M.subresources.names&&void 0!==window.SubResoucesTiming&&(n=M.subresources.lastImage||"",r=M.subresources.firstImage||"",(o=new window.SubResoucesTiming(M.subresources.names,n,r)).length&&"fsImg"===o[o.length-1].id&&(i.push({data:{"page.atf":o[o.length-1].start},ts:String((new Date).valueOf())}),i.push({data:{"page.c_atf":o[o.length-1].start-O(t.responseStart,t.navigationStart)},ts:String((new Date).valueOf())})));var a,s=0;try{l.getEntriesByType("paint").forEach(function(e,t,n){"first-paint"===e.name&&(s=e.startTime)})}catch(e){}!s&&t.msFirstPaint&&"number"==typeof t.msFirstPaint&&(s=O(t.msFirstPaint,t.navigationStart)),!s&&window.chrome&&window.chrome.loadTimes&&(a=window.chrome.loadTimes(),s=Math.round(1e3*(a.firstPaintTime-a.startLoadTime))),("number"!=typeof s||s<0)&&(s=void 0),i.push({data:{"page.firstPaint":s},ts:String((new Date).valueOf())}),"undefined"!=typeof M&&M.TimeTracker&&M.TimeTracker.fst&&i.push({data:{"page.firstScreen":O(M.TimeTracker.fst,t.navigationStart)},ts:M.TimeTracker.fst}),window.mta&&window.mta("send","_page",i)}else u<10&&(c=window.setTimeout(e,100))}())}},Z={type:"timer",data:function(){var e=window.performance||window.mozPerformance;if(e&&e.getEntriesByType){for(var t,n=e.getEntriesByType("resource"),r=[],o=0;o<n.length;o++){var i=n[o],a="".concat(i.name,"?"),s={path:a.slice(0,a.indexOf("?")),type:i.initiatorType},c=[{data:{"browser.resource.receive":O(i.responseEnd,i.fetchStart)},ts:(t=i.responseEnd,parseInt(t)+parseInt(window.performance.timeOrigin)),tags:s}];r.push(c)}return r}}},ee={type:"timer",data:function(e,t){var r=0<arguments.length&&void 0!==e?e:{},o=1<arguments.length?t:void 0,n=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance,i=100,a=20,s=null,c=0;n&&n.getEntriesByType&&!function e(){c++,s&&(window.clearTimeout(s),s=null);var t=n.getEntriesByType("paint");t&&t.length?t.forEach(function(e,t,n){"first-contentful-paint"===e.name&&function(e){try{o&&o("browser.page",[{data:{"browser.page.fcp":e},ts:parseInt(e)+parseInt(window.performance.timeOrigin),tags:r}])}catch(e){}}(e.startTime)}):c<a&&(s=window.setTimeout(e,i))}()}},te={type:"timer",data:function(e,t){var n=0<arguments.length&&void 0!==e?e:{},r=1<arguments.length?t:void 0;L&&L.getFirstConsistentlyInteractive().then(function(e){!function(e){try{r&&r("browser.page",{tti:e},n)}catch(e){}}(e)})}},ne={type:"timer",data:function(e,t,n){var r,o,i,a,s,c,u,l,f,d,h,g,p,v=1<arguments.length&&void 0!==t?t:{},m=2<arguments.length?n:void 0,w=window.requestAnimationFrame;y(w)&&(r=e&&e.selectors||[],c=!(i=[]),d=f=u=a=0,h=function(e){var t=(c=e)?"scrollstart":"scrollstop";window.dispatchEvent(new Event(t))},j.addEventToSelectors(r,"scroll",function(){c||h(!0),clearTimeout(s),s=setTimeout(function(){h(!1)},50)}),j.addEvent("scrollstart",function(){console.log("scrollstart"),clearTimeout(l),u=performance.now(),o=w(p)}),j.addEvent("scrollstop",function(){console.log("scrollstop"),f=performance.now(),10<=i.length&&(d+=f-u,a+=i.filter(function(e){return u<=e&&e<=f-1e3/60}).length),i=[],window.cancelAnimationFrame(o),l=setTimeout(function(){var e,t;10<=a&&(e=1e3*a/d,t=Math.round(10*e)/10,g(t)),i=[],a=d=f=u=0},1e3)}),g=function(e){try{m&&m("browser.page",{scrollFPS:e},v)}catch(e){}},p=function e(t){i.push(t),o=w(e)})}};B.addPlugin("browser.page.business",X),B.addPlugin("fps",Y),B.addPlugin("page",$),B.addPlugin("resources",Z),B.addPlugin("fcp",ee),B.addPlugin("tti",te),B.addPlugin("scrollFPS",ne),W=function(){if(window.MeituanAnalyticsObject){var e=window.MeituanAnalyticsObject;"[object String]"===Object.prototype.toString.call(e)&&(e=[e]);for(var n,t=0;t<e.length;t++)!function(e){var t,n,r,o,i=window[e];y(i)&&(i.q&&i.q.isInitialized&&i.q.initialized()||(t=new B,n=i?i.q:[],i.q=t,v(n)&&(r=[],o=[],n.forEach(function(e){e&&!e.length?r.push(e):o.push(e)}),t.execute.apply(t,o),r.map(function(e){return e.hanlder=t.execute.apply(t,[e.arguments]),e.hasCanceled?e.hanlder.cancel():e.hasEnded&&e.hanlder.test(function(){return e.success},e.log),e}))))}(e[t]);window.mta&&window.mta.q&&window.mta.q.trackerConfig&&window.mta.q.trackerConfig.token||(n=K,b({url:"//portal-portm.sankuai.com/metrics_web/config/report",success:function(e){try{var t=JSON.parse(e);n(t)}catch(e){console.error("JSON.parse mta config",e)}},fail:function(e){console.error("get mta config",e)}}))}},"complete"===document.readyState?W():j.addEvent("load",W)}();
